{"ast":null,"code":"import _regeneratorRuntime from\"/Users/mariyannikolov/Documents/GitHub/BG-Baba/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/mariyannikolov/Documents/GitHub/BG-Baba/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/mariyannikolov/Documents/GitHub/BG-Baba/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import styles from\"./ItemDetailsPage.module.css\";import\"../../reset.css\";import{useEffect}from\"react\";import{useParams,Link,useNavigate}from\"react-router-dom\";import*as itemsService from\"../../services/itemsService\";import*as commentService from\"../../services/commentService\";import{useItemContext}from\"../../contexts/ItemContext\";import{useAuthContext}from\"../../contexts/AuthContext\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var ItemDetailsPage=function ItemDetailsPage(){var _currentItem$comments;var _useParams=useParams(),itemId=_useParams.itemId;var _useAuthContext=useAuthContext(),user=_useAuthContext.user,isAuthenticated=_useAuthContext.isAuthenticated;var navigate=useNavigate();var _useItemContext=useItemContext(),addComment=_useItemContext.addComment,fetchItemDetails=_useItemContext.fetchItemDetails,selectItem=_useItemContext.selectItem,removeItem=_useItemContext.removeItem;var currentItem=selectItem(itemId);var isOwner=currentItem._ownerId===user._id;useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var itemDetails,itemComments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return itemsService.getOne(itemId);case 2:itemDetails=_context.sent;_context.next=5;return commentService.getByItemId(itemId);case 5:itemComments=_context.sent;console.log(user._id==itemDetails._ownerId);fetchItemDetails(itemId,_objectSpread(_objectSpread({},itemDetails),{},{comments:itemComments.map(function(x){return\"\".concat(x.user.email,\": \").concat(x.text);})}));case 8:case\"end\":return _context.stop();}}},_callee);}))();},[]);var addCommentHandler=function addCommentHandler(e){e.preventDefault();var formData=new FormData(e.target);var comment=formData.get(\"comment\");if(comment===\"\"){alert(\"Comment can not be empty!\");return;}commentService.create(itemId,comment).then(function(result){addComment(itemId,comment);});e.target.reset();};var deleteItemHandler=function deleteItemHandler(){var confirmation=window.confirm(\"Are you sure you want to delete the item?\");if(confirmation){itemsService.remove(itemId).then(function(){removeItem(itemId);navigate(\"/items\");});}};return/*#__PURE__*/_jsx(\"div\",{className:styles.mainWrapper,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.innerWrapper,children:[/*#__PURE__*/_jsx(\"h1\",{className:styles.heading,children:\"Item Details\"}),/*#__PURE__*/_jsxs(\"h1\",{children:[\"Item Type: \",currentItem.type]}),/*#__PURE__*/_jsx(\"img\",{className:styles.img,src:currentItem.img}),/*#__PURE__*/_jsxs(\"h4\",{children:[\"Size: \",currentItem.size]}),/*#__PURE__*/_jsxs(\"h4\",{children:[\"Gender: \",currentItem.gender]}),/*#__PURE__*/_jsxs(\"h4\",{children:[\"Price: \",currentItem.price]}),/*#__PURE__*/_jsxs(\"h2\",{children:[\"Created By: \",currentItem.creator]}),/*#__PURE__*/_jsxs(\"h2\",{children:[\"Creator's Phone Number: \",currentItem.phone]}),isOwner&&/*#__PURE__*/_jsxs(\"div\",{className:styles.btns,children:[/*#__PURE__*/_jsx(Link,{to:\"/items/\".concat(itemId,\"/edit\"),className:styles.editBtn,children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:deleteItemHandler,className:styles.delBtn,children:\"Delete\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.commentsWrapper,children:[/*#__PURE__*/_jsx(\"h2\",{className:styles.commentsText,children:\"Comments:\"}),/*#__PURE__*/_jsx(\"ul\",{role:\"list\",children:(_currentItem$comments=currentItem.comments)===null||_currentItem$comments===void 0?void 0:_currentItem$comments.map(function(x){return/*#__PURE__*/_jsx(\"li\",{className:styles.comment,children:/*#__PURE__*/_jsx(\"p\",{children:x})},x);})}),!currentItem.comments&&/*#__PURE__*/_jsx(\"p\",{children:\"No comments.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.createComment,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Comment On Other Sellers:\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.commentFieldAndBtn,children:/*#__PURE__*/_jsxs(\"form\",{className:styles.form,onSubmit:addCommentHandler,children:[/*#__PURE__*/_jsx(\"textarea\",{name:\"comment\",placeholder:\"Comment......\"}),isOwner||!isAuthenticated||!user?/*#__PURE__*/_jsx(\"button\",{className:styles.btnSubmitDisabled,type:\"submit\",disabled:true,children:\" No Comment\"}):/*#__PURE__*/_jsx(\"button\",{className:styles.btnSubmit,type:\"submit\",children:\" Add Comment\"})]})})]})]})});};","map":{"version":3,"names":["styles","useEffect","useParams","Link","useNavigate","itemsService","commentService","useItemContext","useAuthContext","ItemDetailsPage","itemId","user","isAuthenticated","navigate","addComment","fetchItemDetails","selectItem","removeItem","currentItem","isOwner","_ownerId","_id","getOne","itemDetails","getByItemId","itemComments","console","log","comments","map","x","email","text","addCommentHandler","e","preventDefault","formData","FormData","target","comment","get","alert","create","then","result","reset","deleteItemHandler","confirmation","window","confirm","remove","mainWrapper","innerWrapper","heading","type","img","size","gender","price","creator","phone","btns","editBtn","delBtn","commentsWrapper","commentsText","createComment","commentFieldAndBtn","form","btnSubmitDisabled","btnSubmit"],"sources":["/Users/mariyannikolov/Documents/GitHub/BG-Baba/src/components/item-details-page/ItemDetailsPage.js"],"sourcesContent":["import styles from \"./ItemDetailsPage.module.css\";\nimport \"../../reset.css\";\nimport { useEffect } from \"react\";\nimport { useParams, Link, useNavigate } from \"react-router-dom\";\nimport * as itemsService from \"../../services/itemsService\";\nimport * as commentService from \"../../services/commentService\";\nimport { useItemContext } from \"../../contexts/ItemContext\";\nimport { useAuthContext } from \"../../contexts/AuthContext\";\n\nexport const ItemDetailsPage = () => {\n  const { itemId } = useParams();\n  const { user, isAuthenticated } = useAuthContext();\n  const navigate = useNavigate();\n  const { addComment, fetchItemDetails, selectItem, removeItem } =\n    useItemContext();\n  const currentItem = selectItem(itemId);\n\n  const isOwner = currentItem._ownerId === user._id\n\n  useEffect(() => {\n    (async () => {\n      const itemDetails = await itemsService.getOne(itemId);\n      const itemComments = await commentService.getByItemId(itemId);\n\n      console.log(user._id == itemDetails._ownerId);\n\n      fetchItemDetails(itemId, {\n        ...itemDetails,\n        comments: itemComments.map((x) => `${x.user.email}: ${x.text}`),\n      });\n    })();\n  }, []);\n\n  const addCommentHandler = (e) => {\n    e.preventDefault();\n    const formData = new FormData(e.target);\n\n    const comment = formData.get(\"comment\");\n    if (comment === \"\") {\n      alert(\"Comment can not be empty!\");\n      return;\n    }\n\n    commentService.create(itemId, comment).then((result) => {\n      addComment(itemId, comment);\n    });\n    e.target.reset();\n  };\n\n  const deleteItemHandler = () => {\n    const confirmation = window.confirm(\n      \"Are you sure you want to delete the item?\"\n    );\n\n    if (confirmation) {\n      itemsService.remove(itemId).then(() => {\n        removeItem(itemId);\n        navigate(\"/items\");\n      });\n    }\n  };\n\n  return (\n    <div className={styles.mainWrapper}>\n      <div className={styles.innerWrapper}>\n        <h1 className={styles.heading}>Item Details</h1>\n        <h1>Item Type: {currentItem.type}</h1>\n        <img className={styles.img} src={currentItem.img} />\n        <h4>Size: {currentItem.size}</h4>\n        <h4>Gender: {currentItem.gender}</h4>\n        <h4>Price: {currentItem.price}</h4>\n        <h2>Created By: {currentItem.creator}</h2>\n        <h2>Creator's Phone Number: {currentItem.phone}</h2>\n        {isOwner && \n          <div className={styles.btns}>\n            <Link to={`/items/${itemId}/edit`} className={styles.editBtn}>\n              Edit\n            </Link>\n            <button onClick={deleteItemHandler} className={styles.delBtn}>\n              Delete\n            </button>\n          </div>\n        }        \n        <div className={styles.commentsWrapper}>\n          <h2 className={styles.commentsText}>Comments:</h2>\n          <ul role=\"list\">\n            {currentItem.comments?.map((x) => (\n              <li key={x} className={styles.comment}>\n                <p>{x}</p>\n              </li>\n            ))}\n          </ul>\n          {!currentItem.comments && <p>No comments.</p>}\n        </div>\n        <div className={styles.createComment}>\n          <label>Comment On Other Sellers:</label>\n          <div className={styles.commentFieldAndBtn}>\n            <form className={styles.form} onSubmit={addCommentHandler}>\n              <textarea name=\"comment\" placeholder=\"Comment......\" />\n              {isOwner || !isAuthenticated || !user?\n              <button className={styles.btnSubmitDisabled} type=\"submit\" disabled> No Comment</button>\n              :\n              <button className={styles.btnSubmit} type=\"submit\"> Add Comment</button>\n              }\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}